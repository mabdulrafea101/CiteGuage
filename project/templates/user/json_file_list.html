{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block custom_css %}
{% load static %}
<style>
  /* Custom styles for DataTables to match the glassmorphic theme */
  @import url("{% static 'css/dataTables.glass.css' %}");

  /* Specific adjustments for the "Actions" column */
  #jsonFilesTable .btn-group .btn {
    background-color: rgba(255, 255, 255, 0.1) !important;
    border-color: rgba(255, 255, 255, 0.2) !important;
    color: white !important;
  }

  #jsonFilesTable .btn-group .btn:hover {
    background-color: rgba(45, 255, 135, 0.3) !important;
    border-color: rgba(45, 255, 135, 0.5) !important;
  }
</style>
{% endblock custom_css %}

{% block main_content %}
<div class="container my-5">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0 text-white">
          <i class="fas fa-file-code me-2 text-primary"></i>
          JSON Data Files
        </h2>
        <a href="{% url 'import_papers_from_json' %}" class="btn btn-primary-glass">
          <i class="fas fa-file-import me-2"></i>Import Papers from JSON
        </a>
      </div>
      
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
      
      <div class="glass-card">
        <div class="card-body">
          {% if files %}
            <div class="table-responsive">
              <table id="jsonFilesTable" class="table table-glass table-hover table-striped" style="width:100%">
                <thead>
                  <tr>
                    <th>File Name</th>
                    <th>Size</th>
                    <th>Last Modified</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for file in files %}
                    <tr>
                      <td>
                        <i class="fas fa-file-alt text-secondary me-2"></i>
                        {{ file.name }}
                        <br>
                        <small class="text-glass-muted">{{ file.path }}</small>
                      </td>
                      <td>{{ file.size|filesizeformat }}</td>
                      <td>{{ file.modified_time|naturaltime }}</td>
                      <td>
                        <div class="btn-group">
                          <a href="{% url 'json_file_detail' %}?file={{ file.full_path|urlencode }}" class="btn btn-sm btn-outline-info" title="View Data">
                            <i class="text-success fas fa-eye"></i>
                          </a>
                          <a href="{% url 'json_file_table_detail' %}?file={{ file.full_path|urlencode }}" class="btn btn-sm btn-outline-primary" title="View as Table">
                            <i class="text-info fas fa-table"></i>
                          </a>
                        </div>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="text-center py-5">
              <i class="fas fa-folder-open fa-3x text-glass-muted mb-3"></i>
              <h4 class="text-white">No JSON files found</h4>
              <p class="text-glass-muted">The `json_data` directory is empty or does not exist.</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock main_content %}

{% block custom_js %}
{{ block.super }}
<script>
$(document).ready(function() {
    $('#jsonFilesTable').DataTable({
        "pageLength": 10,
        "lengthMenu": [ [10, 25, 50, -1], [10, 25, 50, "All"] ],
        "order": [[ 2, "desc" ]], // Sort by 'Last Modified' column descending by default
        "columnDefs": [
            { "orderable": false, "targets": 3 } // Disable sorting on 'Actions' column
        ]
    });
});
</script>
{% endblock custom_js %}