{% extends "base.html" %}
{% load static %}

{% block custom_css %}
<style>
  /* Custom styles for DataTables transparency and glassmorphic look */
  .dataTables_wrapper .dataTables_filter input,
  .dataTables_wrapper .dataTables_length select {
    background-color: rgba(255, 255, 255, 0.1); /* Light transparent background for inputs */
    border: 1px solid rgba(255, 255, 255, 0.2); /* Subtle border */
    color: white; /* White text */
    backdrop-filter: blur(5px); /* Glassmorphic blur */
    -webkit-backdrop-filter: blur(5px);
  }

  .dataTables_wrapper .dataTables_filter input::placeholder,
  .dataTables_wrapper .dataTables_length select {
    color: rgba(255, 255, 255, 0.7); /* Lighter placeholder text */
  }

  .dataTables_wrapper .dataTables_filter label,
  .dataTables_wrapper .dataTables_length label,
  .dataTables_wrapper .dataTables_info,
  .dataTables_wrapper .dataTables_paginate .paginate_button {
    color: rgba(255, 255, 255, 0.8) !important; /* Light text for labels and pagination */
  }

  .dataTables_wrapper .dataTables_paginate .paginate_button.current,
  .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
    background-color: rgba(45, 255, 135, 0.4) !important; /* Accent color for current page */
    border-color: rgba(45, 255, 135, 0.6) !important;
    color: white !important;
  }

  .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
    background-color: rgba(255, 255, 255, 0.1) !important; /* Subtle hover for pagination buttons */
    border-color: rgba(255, 255, 255, 0.2) !important;
  }

  /* Table specific styles */
  #papersTable {
    background-color: rgba(255, 255, 255, 0.05); /* Transparent background for the table */
    border: 1px solid rgba(255, 255, 255, 0.1); /* Subtle border for the table */
    color: white; /* Default text color for table content */
    backdrop-filter: blur(5px); /* Apply blur to the table itself */
    -webkit-backdrop-filter: blur(5px);
    border-radius: var(--jp-border-radius); /* Match card border-radius */
  }

  #papersTable thead th {
    background-color: rgba(255, 255, 255, 0.15); /* Slightly more opaque for header */
    color: white; /* White text for headers */
    border-bottom: 1px solid rgba(255, 255, 255, 0.3); /* Stronger border for header bottom */
  }

  #papersTable tbody tr {
    background-color: transparent; /* Ensure rows are transparent by default */
    color: rgba(255, 255, 255, 0.9); /* Slightly transparent white for row text */
  }

  #papersTable tbody tr.odd {
    background-color: rgba(255, 255, 255, 0.03); /* Subtle stripe for odd rows */
  }

  #papersTable tbody tr:hover {
    background-color: rgba(45, 255, 135, 0.2); /* Accent color for hover */
    color: white; /* Ensure text remains white on hover */
  }

  /* Adjust borders for cells to match the transparent theme */
  #papersTable th, #papersTable td {
    border-color: rgba(255, 255, 255, 0.1) !important; /* Light transparent borders for cells */
  }

  /* Ensure the glass-card background is not duplicated */
  .glass-card .card-body #papersTable {
    background-color: transparent; /* Let the parent glass-card handle the main background */
    backdrop-filter: none; /* Remove redundant blur if table is inside glass-card */
    -webkit-backdrop-filter: none;
    border: none; /* Remove redundant border if table is inside glass-card */
  }
</style>
{% endblock custom_css %}


{% block main_content %}
<div class="container my-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0 text-white">
      <i class="fas fa-table me-2 text-primary"></i>
      {{ file_name }}
    </h2>
    <a href="{% url 'json_file_list' %}" class="btn btn-secondary-glass">
      <i class="fas fa-arrow-left me-2"></i>Back to File List
    </a>
  </div>

  <div class="glass-card">
    <div class="card-body">
      <h5 class="card-title text-white">Paper Records</h5>
      {% if papers %}
        <div class="table-responsive">
          <table id="papersTable" class="table table-hover table-striped" style="width:100%">
            <thead>
              <tr>
                <th>UID</th>
                <th>Title</th>
                <th>Published At</th>
                <th>Type</th>
              </tr>
            </thead>
            <tbody>
              {% for paper in papers %}
                <tr>
                  <td>{{ paper.uid }}</td>
                  <td>{{ paper.title }}</td>
                  <td>{{ paper.pubyear }}</td>
                  <td>{{ paper.pubtype|default:"N/A" }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-glass-muted">The file is empty or does not contain valid records.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock main_content %}

{% block custom_js %}
{{ block.super }}
<script>
$(document).ready(function() {
    $('#papersTable').DataTable({
        "pageLength": 10,
        "lengthMenu": [ [10, 25, 50, -1], [10, 25, 50, "All"] ],
        "order": [[ 2, "desc" ]] // Sort by 'Year' column descending by default
    });
});
</script>
{% endblock custom_js %}